I"Ò<h2 id="giá»›i-thiá»‡u"><strong>Giá»›i thiá»‡u</strong></h2>
<p>Xin chÃ o! HÃ´m nay mÃ¬nh sáº½ hÆ°á»›ng dáº«n cÃ¡ch báº¯t Ä‘áº§u viáº¿t má»™t Macro Ä‘Æ¡n giáº£n cho pháº§n má»m Revit. Macro lÃ  má»™t Ä‘oáº¡n mÃ£ dÃ¹ng Ä‘á»ƒ tá»± Ä‘á»™ng hÃ³a má»™t hÃ nh Ä‘á»™ng trong Revit nhÆ° tá»± Ä‘á»™ng táº¡o, xÃ³a, sá»¯a cÃ¡c Ä‘á»‘i tÆ°á»£ng, quáº£n lÃ½ thÃ´ng tin cá»§a dá»± Ã¡n, tÆ° Ä‘á»™ng xuáº¥t thÃ´ng tin dá»± Ã¡n vvâ€¦ GiÃºp cho cÃ´ng viá»‡c cá»§a cÃ¡c ká»¹ sÆ° thiáº¿t káº¿ trá»Ÿ nÃªn dá»… dÃ ng hÆ¡n. Má»—i phiÃªn báº£n Revit Ä‘iá»u Ä‘Ã£ Ä‘Æ°á»£c tÃ­ch há»£p sáºµn Macro vÃ¬ tháº¿ báº¡n khÃ´ng cáº§n cÃ i Ä‘áº·t thÃªm báº¥t cá»© pháº§n má»m nÃ o. Trong cÃ¡c vÃ­ dá»¥ dÆ°á»›i Ä‘Ã¢y mÃ¬nh sáº½ sá»¯ dá»¥ng revit 2020 vÃ  ngÃ´n ngá»¯ c#, giá» chÃºng ta sáº½ báº¯t Ä‘áº§u Ä‘i vÃ o cÃ¡c bÆ°á»›c.</p>
<h2 id="bÆ°á»›c-1-má»Ÿ-revit-macro-manager"><strong>BÆ°á»›c 1: Má»Ÿ Revit Macro Manager</strong></h2>
<p>Äáº§u tiÃªn cÃ¡c báº¡n vÃ o dá»± Ã¡n, sau Ä‘Ã³ vÃ o tab <strong>Manage</strong> vÃ  chá»n icon <strong>Macro Manager</strong>.</p>

<p><img src="/MyBlog/assets/img/how-to-write-a-macro/ribbon.png" alt="ribon" /></p>

<p>Cá»­a sá»• Macro Manager báº­t lÃªn, báº¡n sáº½ tháº¥y 2 tab lÃ  <strong>application</strong> vÃ  <strong>tá»‡p dá»± Ã¡n</strong> cá»§a báº¡n . Nhá»¯ng Macro viáº¿t trÃªn tab application sáº½ sá»± dá»¥ng Ä‘Æ°á»£c lÆ°u vÃ o cáº¥u hÃ¬nh ngÆ°á»i dÃ¹ng cá»§a Revit, cÃ¡c Macro nÃ y cÃ³ thá»ƒ sá»¯ dá»¥ng cho báº¥t ká»³ mÃ´ hÃ¬nh nÃ o nhÆ°ng chá»‰ vá»›i ngÆ°á»i dÃ¹ng Ä‘Ã£ táº¡o nÃ³. Nhá»¯ng Macro viáº¿t trÃªn tab tá»‡p dá»± Ã¡n cá»§a báº¡n cÃ³ thá»ƒ sá»¯ dá»¥ng cho báº¥t ká»³ ai má»Ÿ mÃ´ hÃ¬nh Ä‘Ã³.</p>

<p><img src="/MyBlog/assets/img/how-to-write-a-macro/img1.png" alt="img1" /></p>

<h2 id="bÆ°á»›c-2-táº¡o-module"><strong>BÆ°á»›c 2: Táº¡o module</strong></h2>
<p>CÃ¡c Macro Ä‘Æ°á»£c cÃ¢u trÃºc theo dáº¡ng <strong>Module</strong>, má»™t Module bao gá»“m nhiá»u Macro, tÃªn Module vÃ  Macro khÃ´ng Ä‘Æ°á»£c chá»©a kÃ½ tá»± Ä‘áº·c biá»‡t vÃ  khoáº£ng tráº¯ng.</p>

<p><img src="/MyBlog/assets/img/how-to-write-a-macro/img7.png" alt="img7" /></p>

<p>Nháº¥n nÃºt Module trong pháº§n <strong>Create</strong> Ä‘á»ƒ táº¡o má»™t Module má»›i. Revit há»— trá»£ cho chÃºng ta 4 ngÃ´n ngá»¯ lÃ  C#, Python, Ruby vÃ  VB.net. CÃ¡c báº¡n nháº­p tÃªn, chá»n ngÃ´n ngá»¯ vÃ  nháº­p mÃ´ táº£(cÃ³ thá»ƒ Ä‘á»ƒ trá»‘ng) cho Module vÃ  chá»n nÃºt <strong>ok</strong>. Sau Ä‘Ã³ Revit sáº½ tá»± Ä‘á»™ng táº¡o vÃ  má»Ÿ file báº±ng chÆ°Æ¡ng trÃ¬nh SharpDevelop. giao diá»‡n chÆ°á»ng trÃ¬nh nhÆ° hÃ¬nh dÆ°á»›i.</p>

<p><img src="/MyBlog/assets/img/how-to-write-a-macro/img2.png" alt="img1" /></p>

<p>Sau khi cÃ³ Module báº¡n cÃ³ thá»ƒ táº¡o má»™t Macro báº±ng cÃ¡ch nháº¥n vÃ o Module vá»«a táº¡o vÃ  chá»n nÃºt Macro trong pháº§n Create. Báº£n cháº¥t cá»§a Macro giá»‘ng nhÆ° má»™t hÃ m(funtion) trong má»™t tá»‡p Module. HÃ m lÃ  má»™t cáº¥u trÃºc cÆ¡ báº£n trong cÃ¡c ngÃ´n ngá»¯ láº­p trÃ¬nh, mÃ¬nh cÃ³ thá»ƒ nÃ³i vá» chÃºng trong cÃ¡c bÃ i viáº¿t khÃ¡c. Sau khi táº¡o má»™t Macro, chÃºng sáº½ cÃ³ cáº¥u trÃºc nhÆ° hÃ¬nh dÆ°á»›i.</p>

<p><img src="/MyBlog/assets/img/how-to-write-a-macro/img3.png" alt="img1" /></p>

<p>Theo nhÆ° trong hÃ¬nh thÃ¬ Macro cá»§a chÃºng ta lÃ  hÃ m MacroTest() vÃ  Ä‘Ã³ lÃ  chá»— chÃºng ta sáº½ viáº¿t mÃ£.</p>
<h2 id="bÆ°á»›c-3-viáº¿t-mÃ£"><strong>bÆ°á»›c 3: Viáº¿t mÃ£</strong></h2>
<p>Báº¡n gÃµ vÃ o hÃ m Ä‘oáº¡n mÃ£ sau Ä‘Ã¢y, Macro Ä‘áº§u tiÃªn cá»§a báº¡n sáº½ Ä‘Æ¡n giáº£n lÃ  in ra mÃ n hÃ¬nh dÃ²ng chá»¯ Hello World.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>public void MacroTest<span class="o">()</span>
<span class="o">{</span>
	TaskDialog.Show<span class="o">(</span><span class="s2">"hello"</span>,<span class="s2">"hello world"</span><span class="o">)</span><span class="p">;</span>
<span class="o">}</span>
</code></pre></div></div>
<h2 id="bÆ°á»›c-4-build"><strong>bÆ°á»›c 4: build</strong></h2>
<p>Sau khi viáº¿t xong báº¡n chá»n <strong>build project</strong> trong tab <strong>Build</strong> hoáº·c nháº¥p <strong>F9</strong> Ä‘á»ƒ build Macro.</p>

<p><img src="/MyBlog/assets/img/how-to-write-a-macro/img8.png" alt="img1" /></p>

<p>Náº¿u cÃ³ báº¥t ká»³ lá»—i hay cáº£nh bÃ¡o nÃ o chÃºng sáº½ xuáº¥t hiá»‡n á»¡ cá»­a sá»• nÃ y.</p>

<p><img src="/MyBlog/assets/img/how-to-write-a-macro/img9.png" alt="img1" /></p>

<p>Náº¿u ngÆ°á»£c láº¡i báº¡n sáº½ tháº¥y dÃ²ng chá»¯ <strong>Build finished successfully</strong> á»¡ gÃ³c trÃ¡i dÆ°á»›i cÃ¹ng. Quay láº¡i Revit, chá»n macro vá»«a táº¡o vÃ  nháº¥n nÃºt <strong>Run</strong>.</p>

<p><img src="/MyBlog/assets/img/how-to-write-a-macro/img4.png" alt="img1" /></p>

<p>VÃ  Ä‘Ã¢y lÃ  káº¿t quáº£.</p>

<p><img src="/MyBlog/assets/img/how-to-write-a-macro/img5.png" alt="img1" /></p>

<h2 id="má»™t-vÃ i-thay-Ä‘á»•i"><strong>Má»™t vÃ i thay Ä‘á»•i</strong></h2>
<p>Vá»«a rá»“i chÃºng ta vá»«a táº¡o Ä‘Æ°á»£c má»™t Macro vÃ´ cÃ¹ng Ä‘Æ¡n giáº£n trong Revit. Sau Ä‘Ã¢y chÃºng ta sáº½ sá»¯ dá»¥ng Macro Ä‘á»ƒ can thiá»‡p sÃ¢u hÆ¡n vÃ o mÃ´ hÃ¬nh.</p>
<h3 id="get-all-wall">Get All Wall</h3>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>public void getAllWall<span class="o">()</span>
<span class="o">{</span>
    //get all wall
    IEnumerable&lt;Element&gt; lstWall <span class="o">=</span> new FilteredElementCollector<span class="o">(</span>Document<span class="o">)</span>.OfCategory<span class="o">(</span>BuiltInCategory.OST_Walls<span class="o">)</span>
        .WhereElementIsNotElementType<span class="o">()</span><span class="p">;</span>
    // add the name of wall into a string
    string s <span class="o">=</span> string.Empty<span class="p">;</span>
    foreach <span class="o">(</span>Element element <span class="k">in </span>lstWall<span class="o">)</span> <span class="o">{</span>
        s +<span class="o">=</span> element.Name + <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
    <span class="o">}</span>
    //show the wall list
    TaskDialog.Show<span class="o">(</span><span class="s2">"list wall"</span>,s<span class="o">)</span><span class="p">;</span>
<span class="o">}</span>
</code></pre></div></div>
<p>Äoáº¡n code trÃªn cho phÃ©p báº¡n láº¥y tÃªn cá»§a táº¥t cáº£ cÃ¡c Wall tá»« dá»± Ã¡n hiá»‡n táº¡i vÃ  in ra mÃ n hÃ¬nh, Ä‘Ã¢y lÃ  káº¿t quáº£.</p>

<p><img src="/MyBlog/assets/img/how-to-write-a-macro/img6.png" alt="img1" /></p>

<h3 id="delete-all-wall">Delete All Wall</h3>
<p>ÄÃ¢y lÃ  Ä‘oáº¡n mÃ£ xÃ³a wall tá»« danh sÃ¡ch Ä‘Ã£ láº¥y Ä‘Æ°á»£c á»¡ trÃªn</p>
<pre><code class="language-pash">public void deleteAllElement()
{
    //get all walls in project
    ICollection&lt;ElementId&gt; lstWall = new FilteredElementCollector(Document).OfCategory(BuiltInCategory.OST_Walls)
        .WhereElementIsNotElementType().ToElementIds();
    //start a transaction
    using(Transaction tran = new Transaction(Document))
    {
        
        tran.Start("start");
        //delete list wall
        Document.Delete(lstWall);
        tran.Commit();
        
    }
    //notification
    TaskDialog.Show("delete walls","successfully");
}
</code></pre>

<h2 id="káº¿t">káº¿t</h2>
<p>Viáº¿t macro lÃ  bÆ°á»›c Ä‘áº§u Ä‘á»ƒ tá»± Ä‘á»™ng hÃ³a nhá»¯ng cÃ´ng viá»‡c láº·p Ä‘i láº·p láº¡i khi váº½. CÃ³ Ä‘Æ°á»£c ká»¹ nÄƒng láº­p trÃ¬nh Revit sáº½ giÃºp báº¡n tÄƒng hiá»‡u xuáº¥t lÃ m viá»‡c lÃªn ráº¥t nhiá»u nhÆ°ng Ä‘Ã²i há»i báº¡n pháº£i kiÃªn trÃ¬ thá»±c hÃ nh vÃ  láº¥y Ä‘i má»™t pháº§n thá»i gian cá»§a báº¡n Ä‘á»ƒ lÃ m chá»§ Ä‘Æ°á»£c nÃ³. NgoÃ i viáº¿t mÃ£ báº±ng Macro ra báº¡n cÅ©ng cÃ³ thá»ƒ sá»­ dá»¥ng má»™t cÃ´ng cá»¥ trá»±c quan ráº¥t máº¡nh máº½ lÃ  Dynamo hoáº·c viáº¿t Addin cho revit. Nhá»¯ng bÃ i viáº¿t sau mÃ¬nh sáº½ viáº¿t thÃªm vá» láº­p trÃ¬nh <strong>Revit Addin</strong> vÃ  <strong>Dynamo</strong> cÅ©ng nhÆ° tÆ°Æ¡ng tÃ¡c sÃ¢u hÆ¡n vá»›i há»‡ thá»‘ng cá»§a Revit.
CÃ¡c báº¡n cÅ©ng cÃ³ thá»ƒ tÃ¬m nhá»¯ng Addin há»¯u dá»¥ng trá»±c tiáº¿p trÃªn store cá»§a Autodesk. Náº¿u cÃ³ báº¥t ká»³ tháº¯c máº¯c gÃ¬ hÃ£y bÃ¬nh luáº­n bÃªn dÆ°á»›i hoáº·c liÃªn há»‡ trá»±c tiáº¿p vá»›i mÃ¬nh nhÃ©. ChÃºc cÃ¡c báº¡n thÃ nh cÃ´ng.</p>

:ET