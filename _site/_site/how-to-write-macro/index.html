<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Làm thế nào để viết một Revit Macro đơn giản - Hello, world! I'm LAM MINH HY</title>

  <!-- Edit site and author settings in `_config.yml` to make the social details your own -->

    <meta content="Hello, world! I'm LAM MINH HY" property="og:site_name">
  
    <meta content="Làm thế nào để viết một Revit Macro đơn giản" property="og:title">
  
  
    <meta content="article" property="og:type">
  
  
    <meta content="Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description.
" property="og:description">
  
  
    <meta content="http://localhost:4000/how-to-write-macro/" property="og:url">
  
  
    <meta content="2022-02-09T00:00:00+07:00" property="article:published_time">
    <meta content="http://localhost:4000/about/" property="article:author">
  
  
    <meta content="http://localhost:4000/blog/assets/img/how-to-write-a-macro/ribbon.png" property="og:image">
  
  
    
  
  
    
  

    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@">
    <meta name="twitter:creator" content="@">
  
    <meta name="twitter:title" content="Làm thế nào để viết một Revit Macro đơn giản">
  
  
    <meta name="twitter:url" content="http://localhost:4000/how-to-write-macro/">
  
  
    <meta name="twitter:description" content="Write an awesome description for your new site here. You can edit this line in _config.yml. It will appear in your document head meta (for Google search results) and in your feed.xml site description.
">
  
  
    <meta name="twitter:image:src" content="http://localhost:4000/blog/assets/img/how-to-write-a-macro/ribbon.png">
  

	<meta name="description" content="">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<meta property="og:image" content="">
	<link rel="shortcut icon" href="/blog/assets/img/favicon/favicon.ico" type="image/x-icon">
	<link rel="apple-touch-icon" href="/blog/assets/img/favicon/apple-touch-icon.png">
	<link rel="apple-touch-icon" sizes="72x72" href="/blog/assets/img/favicon/apple-touch-icon-72x72.png">
	<link rel="apple-touch-icon" sizes="144x144" href="/blog/assets/img/favicon/apple-touch-icon-144x144.png">
	<!-- Chrome, Firefox OS and Opera -->
	<meta name="theme-color" content="#263959">
	<!-- Windows Phone -->
	<meta name="msapplication-navbutton-color" content="#263959">
	<!-- iOS Safari -->
	<meta name="apple-mobile-web-app-status-bar-style" content="#263959">
	<!-- Google Fonts -->
	<link href="https://fonts.googleapis.com/css?family=PT+Serif:400,700|Lato:300,400,700&display=swap" rel="stylesheet">
	<!-- Font Awesome -->
	<link rel="stylesheet" href="/blog/assets/fonts/font-awesome/css/font-awesome.min.css">
	<!-- Styles -->
	<link rel="stylesheet" href="/blog/assets/css/main.css">
</head>

<body>

  <div class="wrapper">
    <aside class="sidebar">
  <header>
    <div class="about">
      <div class="cover-author-image">
        <a href="/blog/"><img src="/blog/assets/img/my_avata.jpg" alt="Lâm Minh Hy"></a>
      </div>
      <div class="author-name">Lâm Minh Hy</div>
      <p>I am a software developer. Love technology, exercise and music. Always hungry to keep learning.</p>
    </div>
  </header> <!-- End Header -->
  <footer>
    <section class="contact">
      <h3 class="contact-title">Contact me</h3>
      <ul>
        
          <li><a href="https://twitter.com/artemsheludko_" target="_blank"><i class="fa fa-twitter" aria-hidden="true"></i></a></li>
        
        
          <li><a href="https://facebook.com/lam.hyminh" target="_blank"><i class="fa fa-facebook" aria-hidden="true"></i></a></li>
        
        
          <li class="github"><a href="http://github.com/sapiens-code" target="_blank"><i class="fa fa-github"></i></a></li>
        
        
          <li class="linkedin"><a href="https://in.linkedin.com/in/hy-lam" target="_blank"><i class="fa fa-linkedin"></i></a></li>
        
        
          <li class="email"><a href="mailto:lamminhhy9999@gmail.com"><i class="fa fa-envelope-o"></i></a></li>
        
      </ul>
    </section> <!-- End Section Contact -->
    <div class="copyright">
      <p>2022 &copy; Lâm Minh Hy</p>
    </div>
  </footer> <!-- End Footer -->
</aside> <!-- End Sidebar -->
<div class="content-box clearfix">
  <article class="article-page">
  <div class="page-content">
    
    <div class="page-cover-image">
      <figure>
        <img class="page-image" src=/blog/assets/img/how-to-write-a-macro/ribbon.png alt="Làm thế nào để viết một Revit Macro đơn giản">
        
      </figure>
    </div> <!-- End Page Cover Image -->
    
    <div class="wrap-content">
      <header class="header-page">
        <h1 class="page-title">Làm thế nào để viết một Revit Macro đơn giản</h1>
        <div class="page-date"><span>2022, Feb 09&nbsp;&nbsp;&nbsp;&nbsp;</span></div>
      </header>
      <h2 id="giới-thiệu"><strong>Giới thiệu</strong></h2>
<p>Xin chào! Hôm nay mình sẽ hướng dẫn cách bắt đầu viết một Macro đơn giản cho phần mềm Revit. Macro là một đoạn mã dùng để tự động hóa một hành động trong Revit như tự động tạo, xóa, sữa các đối tượng, quản lý thông tin của dự án, tư động xuất thông tin dự án vv… Giúp cho công việc của các kỹ sư thiết kế trở nên dễ dàng hơn. Mỗi phiên bản Revit điều đã được tích hợp sẵn Macro vì thế bạn không cần cài đặt thêm bất cứ phần mềm nào. Trong các ví dụ dưới đây mình sẽ sữ dụng revit 2020 và ngôn ngữ c#, giờ chúng ta sẽ bắt đầu đi vào các bước.</p>
<h2 id="bước-1-mở-revit-macro-manager"><strong>Bước 1: Mở Revit Macro Manager</strong></h2>
<p>Đầu tiên các bạn vào dự án, sau đó vào tab <strong>Manage</strong> và chọn icon <strong>Macro Manager</strong>.</p>

<p><img src="/blog/assets/img/how-to-write-a-macro/ribbon.png" alt="ribon" /></p>

<p>Cửa sổ Macro Manager bật lên, bạn sẽ thấy 2 tab là <strong>application</strong> và <strong>tệp dự án</strong> của bạn . Những Macro viết trên tab application sẽ sự dụng được lưu vào cấu hình người dùng của Revit, các Macro này có thể sữ dụng cho bất kỳ mô hình nào nhưng chỉ với người dùng đã tạo nó. Những Macro viết trên tab tệp dự án của bạn có thể sữ dụng cho bất kỳ ai mở mô hình đó.</p>

<p><img src="/blog/assets/img/how-to-write-a-macro/img1.png" alt="img1" /></p>

<h2 id="bước-2-tạo-module"><strong>Bước 2: Tạo module</strong></h2>
<p>Các Macro được câu trúc theo dạng <strong>Module</strong>, một Module bao gồm nhiều Macro, tên Module và Macro không được chứa ký tự đặc biệt và khoảng trắng.</p>

<p><img src="/blog/assets/img/how-to-write-a-macro/img7.png" alt="img7" /></p>

<p>Nhấn nút Module trong phần <strong>Create</strong> để tạo một Module mới. Revit hỗ trợ cho chúng ta 4 ngôn ngữ là C#, Python, Ruby và VB.net. Các bạn nhập tên, chọn ngôn ngữ và nhập mô tả(có thể để trống) cho Module và chọn nút <strong>ok</strong>. Sau đó Revit sẽ tự động tạo và mở file bằng chương trình SharpDevelop. giao diện chường trình như hình dưới.</p>

<p><img src="/blog/assets/img/how-to-write-a-macro/img2.png" alt="img1" /></p>

<p>Sau khi có Module bạn có thể tạo một Macro bằng cách nhấn vào Module vừa tạo và chọn nút Macro trong phần Create. Bản chất của Macro giống như một hàm(funtion) trong một tệp Module. Hàm là một cấu trúc cơ bản trong các ngôn ngữ lập trình, mình có thể nói về chúng trong các bài viết khác. Sau khi tạo một Macro, chúng sẽ có cấu trúc như hình dưới.</p>

<p><img src="/blog/assets/img/how-to-write-a-macro/img3.png" alt="img1" /></p>

<p>Theo như trong hình thì Macro của chúng ta là hàm MacroTest() và đó là chỗ chúng ta sẽ viết mã.</p>
<h2 id="bước-3-viết-mã"><strong>bước 3: Viết mã</strong></h2>
<p>Bạn gõ vào hàm đoạn mã sau đây, Macro đầu tiên của bạn sẽ đơn giản là in ra màn hình dòng chữ Hello World.</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>public void MacroTest<span class="o">()</span>
<span class="o">{</span>
	TaskDialog.Show<span class="o">(</span><span class="s2">"hello"</span>,<span class="s2">"hello world"</span><span class="o">)</span><span class="p">;</span>
<span class="o">}</span>
</code></pre></div></div>
<h2 id="bước-4-build"><strong>bước 4: build</strong></h2>
<p>Sau khi viết xong bạn chọn <strong>build project</strong> trong tab <strong>Build</strong> hoặc nhấp <strong>F9</strong> để build Macro.</p>

<p><img src="/blog/assets/img/how-to-write-a-macro/img8.png" alt="img1" /></p>

<p>Nếu có bất kỳ lỗi hay cảnh báo nào chúng sẽ xuất hiện ỡ cửa sổ này.</p>

<p><img src="/blog/assets/img/how-to-write-a-macro/img9.png" alt="img1" /></p>

<p>Nếu ngược lại bạn sẽ thấy dòng chữ <strong>Build finished successfully</strong> ỡ góc trái dưới cùng. Quay lại Revit, chọn macro vừa tạo và nhấn nút <strong>Run</strong>.</p>

<p><img src="/blog/assets/img/how-to-write-a-macro/img4.png" alt="img1" /></p>

<p>Và đây là kết quả.</p>

<p><img src="/blog/assets/img/how-to-write-a-macro/img5.png" alt="img1" /></p>

<h2 id="một-vài-thay-đổi"><strong>Một vài thay đổi</strong></h2>
<p>Vừa rồi chúng ta vừa tạo được một Macro vô cùng đơn giản trong Revit. Sau đây chúng ta sẽ sữ dụng Macro để can thiệp sâu hơn vào mô hình.</p>
<h3 id="get-all-wall">Get All Wall</h3>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>public void getAllWall<span class="o">()</span>
<span class="o">{</span>
    //get all wall
    IEnumerable&lt;Element&gt; lstWall <span class="o">=</span> new FilteredElementCollector<span class="o">(</span>Document<span class="o">)</span>.OfCategory<span class="o">(</span>BuiltInCategory.OST_Walls<span class="o">)</span>
        .WhereElementIsNotElementType<span class="o">()</span><span class="p">;</span>
    // add the name of wall into a string
    string s <span class="o">=</span> string.Empty<span class="p">;</span>
    foreach <span class="o">(</span>Element element <span class="k">in </span>lstWall<span class="o">)</span> <span class="o">{</span>
        s +<span class="o">=</span> element.Name + <span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">;</span>
    <span class="o">}</span>
    //show the wall list
    TaskDialog.Show<span class="o">(</span><span class="s2">"list wall"</span>,s<span class="o">)</span><span class="p">;</span>
<span class="o">}</span>
</code></pre></div></div>
<p>Đoạn code trên cho phép bạn lấy tên của tất cả các Wall từ dự án hiện tại và in ra màn hình, đây là kết quả.</p>

<p><img src="/blog/assets/img/how-to-write-a-macro/img6.png" alt="img1" /></p>

<h3 id="delete-all-wall">Delete All Wall</h3>
<p>Đây là đoạn mã xóa wall từ danh sách đã lấy được ỡ trên</p>
<pre><code class="language-pash">public void deleteAllElement()
{
    //get all walls in project
    ICollection&lt;ElementId&gt; lstWall = new FilteredElementCollector(Document).OfCategory(BuiltInCategory.OST_Walls)
        .WhereElementIsNotElementType().ToElementIds();
    //start a transaction
    using(Transaction tran = new Transaction(Document))
    {
        
        tran.Start("start");
        //delete list wall
        Document.Delete(lstWall);
        tran.Commit();
        
    }
    //notification
    TaskDialog.Show("delete walls","successfully");
}
</code></pre>

<h2 id="kết">kết</h2>
<p>Viết macro là bước đầu để tự động hóa những công việc lặp đi lặp lại khi vẽ. Có được kỹ năng lập trình Revit sẽ giúp bạn tăng hiệu xuất làm việc lên rất nhiều nhưng đòi hỏi bạn phải kiên trì thực hành và lấy đi một phần thời gian của bạn để làm chủ được nó. Ngoài viết mã bằng Macro ra bạn cũng có thể sử dụng một công cụ trực quan rất mạnh mẽ là Dynamo hoặc viết Addin cho revit. Những bài viết sau mình sẽ viết thêm về lập trình <strong>Revit Addin</strong> và <strong>Dynamo</strong> cũng như tương tác sâu hơn với hệ thống của Revit.
Các bạn cũng có thể tìm những Addin hữu dụng trực tiếp trên store của Autodesk. Nếu có bất kỳ thắc mắc gì hãy bình luận bên dưới hoặc liên hệ trực tiếp với mình nhé. Chúc các bạn thành công.</p>


      <div class="page-footer">
        <div class="page-share">
          <a href="https://twitter.com/intent/tweet?text=Làm thế nào để viết một Revit Macro đơn giản&url=http://localhost:4000/how-to-write-macro/" title="Share on Twitter" rel="nofollow" target="_blank">Twitter</a>
          <a href="https://facebook.com/sharer.php?u=http://localhost:4000/how-to-write-macro/" title="Share on Facebook" rel="nofollow" target="_blank">Facebook</a>
          <a href="https://plus.google.com/share?url=http://localhost:4000/how-to-write-macro/" title="Share on Google+" rel="nofollow" target="_blank">Google+</a>
        </div>
        <div class="page-tag">
          
        </div>
      </div>
      <section class="comment-area">
  <div class="comment-wrapper">
    
    <div id="disqus_thread" class="article-comments"></div>
    <script>
      (function() {
          var d = document, s = d.createElement('script');
          s.src = '//mr-brown.disqus.com/embed.js';
          s.setAttribute('data-timestamp', +new Date());
          (d.head || d.body).appendChild(s);
      })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    
  </div>
</section> <!-- End Comment Area -->

    </div> <!-- End Wrap Content -->
  </div> <!-- End Page Content -->
</article> <!-- End Article Page -->

</div>

  </div>
  
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', '', 'auto');
  ga('send', 'pageview');
</script> <!-- End Analytics -->

</body>
</html>
